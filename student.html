<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<title>Kingdom College Student Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:0;}
header{background:#0a3d62;color:white;padding:15px;text-align:center;}
.container{max-width:1200px;margin:auto;padding:15px;}
.menu{display:flex;flex-wrap:wrap;gap:5px;justify-content:center;margin-bottom:10px;}
.menu button{padding:10px;border:none;background:#1e3799;color:white;border-radius:5px;cursor:pointer;}
.menu button:hover{background:#4a69bd;}
.section{display:none;background:white;padding:15px;border-radius:8px;box-shadow:0 0 5px gray;margin-bottom:15px;}
.card{border:1px solid #ccc;padding:10px;border-radius:5px;margin:8px 0;}
input,textarea,select,button{width:100%;padding:8px;margin:5px 0;}
.logout{background:red;}
</style>
</head>

<body>

<header>
<h2>Kingdom College Student Portal</h2>
<p id="studentName"></p>
</header>

<div class="container">

<div class="menu">
<button onclick="openSection('profile')">Profile</button>
<button onclick="openSection('subjects')">Subjects</button>
<button onclick="openSection('materials')">Materials</button>
<button onclick="openSection('assignments')">Assignments</button>
<button onclick="openSection('results')">Results</button>
<button onclick="openSection('fees')">Fees</button>
<button onclick="openSection('messages')">Counsellor</button>
<button onclick="openSection('sports')">Sports</button>
<button onclick="logout()" class="logout">Logout</button>
</div>

<!-- PROFILE -->
<div id="profile" class="section">
<h3>My Profile</h3>
<div class="card">
<p><b>Registration No:</b> <span id="regNo"></span></p>
<p><b>Full Name:</b> <span id="fullName"></span></p>
<p><b>Course:</b> <span id="course"></span></p>
<p><b>Level:</b> <span id="level"></span></p>
<p><b>Semester:</b> <span id="semester"></span></p>
</div>
</div>

<!-- SUBJECTS -->
<div id="subjects" class="section">
<h3>Subjects</h3>
<div id="subjectList"></div>
</div>

<!-- MATERIALS -->
<div id="materials" class="section">
<h3>Study Materials</h3>
<div id="materialList"></div>
</div>

<!-- ASSIGNMENTS -->
<div id="assignments" class="section">
<h3>Assignments</h3>
<select id="assignSubject"></select>
<textarea id="assignText" placeholder="Write assignment..."></textarea>
<button onclick="submitAssignment()">Submit Assignment</button>
<div id="assignList"></div>
</div>

<!-- RESULTS -->
<div id="results" class="section">
<h3>Results</h3>
<div id="resultsList"></div>
</div>

<!-- FEES -->
<div id="fees" class="section">
<h3>Fees Status</h3>
<div id="feesList"></div>
</div>

<!-- MESSAGES -->
<div id="messages" class="section">
<h3>Message to Counsellor</h3>
<textarea id="msgText" placeholder="Write message..."></textarea>
<button onclick="sendMessage()">Send</button>
<div id="msgList"></div>
</div>

<!-- SPORTS -->
<div id="sports" class="section">
<h3>Sports & Games</h3>
<div id="sportsList"></div>
</div>

</div>

<footer style="text-align:center;padding:10px;">© 2026 Kingdom College | By Carina</footer>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
 apiKey: "AIzaSyAcL_PjNww-ea6d33irNgWbn1EsBq4acTA",
 authDomain: "collegeportal-app.firebaseapp.com",
 databaseURL: "https://collegeportal-app-default-rtdb.firebaseio.com",
 projectId: "collegeportal-app",
 storageBucket: "collegeportal-app.firebasestorage.app",
 messagingSenderId: "266762331631",
 appId: "1:266762331631:web:66ddfbde53d33086ac421a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Check login
let reg = localStorage.getItem("student");
if(!reg){ window.location = "index.html"; }
document.getElementById("studentName").innerText = "Welcome: " + reg;
document.getElementById("regNo").innerText = reg;

// Load profile
db.ref("students/"+reg).once("value").then(snap=>{
 let data = snap.val();
 if(data){
   document.getElementById("fullName").innerText = data.name;
   document.getElementById("course").innerText = data.course;
   document.getElementById("level").innerText = data.level;
   document.getElementById("semester").innerText = data.semester;
   loadSubjects(data.level,data.semester);
   loadMaterials(data.level,data.semester);
   loadResults();
   loadFees();
   loadSports();
 } else {
   alert("Complete your profile first.");
   window.location="profile.html";
 }
});

// Level/Semester Subjects
const subjectsData = {
4:{1:["Communication","Anatomy","Physiology","Computer","Epidemiology & Biostatistics","Medical Ethics","Microbiology"],
   2:["Clinical Skills","Clinical Nutrition","Patient Care","Clinical Laboratory","Pathology"]},
5:{1:["Pediatric 1","Internal Medicine 1","Obstetrics 1","Pharmacology","Counselling","Health Promotion"],
   2:["Pediatric 2","Internal Medicine 2","Surgery","Obstetrics 2","RSH"]},
6:{1:["Coming Soon"],2:["Coming Soon"]}
};

function openSection(id){
 document.querySelectorAll(".section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
}

function loadSubjects(level,semester){
 let list = subjectsData[level][semester] || [];
 let box = document.getElementById("subjectList");
 box.innerHTML="";
 list.forEach(s=>{ box.innerHTML += `<div class="card">${s}</div>`; });
 // fill assignment select
 let sel = document.getElementById("assignSubject");
 sel.innerHTML="";
 list.forEach(s=>{ sel.innerHTML += `<option value="${s}">${s}</option>`; });
}

function loadMaterials(level,semester){
 let box = document.getElementById("materialList");
 db.ref("materials/"+level+"/"+semester).once("value").then(snap=>{
   box.innerHTML="";
   snap.forEach(child=>{
     box.innerHTML += `<div class="card"><b>${child.val().title}</b><br>${child.val().desc}</div>`;
   });
 });
}

// Assignments
function submitAssignment(){
 let sub = document.getElementById("assignSubject").value;
 let text = document.getElementById("assignText").value;
 if(!text){ alert("Write assignment"); return; }
 db.ref("submissions/"+reg).push({subject:sub,text:text,timestamp:Date.now()});
 document.getElementById("assignText").value="";
 alert("Assignment submitted ✅");
 loadAssignments();
}

function loadAssignments(){
 db.ref("submissions/"+reg).once("value").then(snap=>{
   let box = document.getElementById("assignList");
   box.innerHTML="";
   snap.forEach(child=>{
     let val = child.val();
     box.innerHTML += `<div class="card"><b>${val.subject}</b><p>${val.text}</p></div>`;
   });
 });
}
loadAssignments();

// Results
function loadResults(){
 let box = document.getElementById("resultsList");
 db.ref("results/"+reg).once("value").then(snap=>{
   box.innerHTML="";
   snap.forEach(child=>{
     let val = child.val();
     box.innerHTML += `<div class="card"><b>${val.subject}</b>: ${val.mark}</div>`;
   });
 });
}

// Fees
function loadFees(){
 let box = document.getElementById("feesList");
 db.ref("fees/"+reg).once("value").then(snap=>{
   let val = snap.val() || {paid:0,balance:0};
   box.innerHTML = `<div class="card">Paid: TZS ${val.paid}<br>Balance: TZS ${val.balance}</div>`;
 });
}

// Messages
function sendMessage(){
 let msg = document.getElementById("msgText").value;
 if(!msg){ alert("Write message"); return; }
 db.ref("messages/"+reg).push({text:msg,timestamp:Date.now()});
 document.getElementById("msgText").value="";
 loadMessages();
}

function loadMessages(){
 let box = document.getElementById("msgList");
 db.ref("messages/"+reg).once("value").then(snap=>{
   let box = document.getElementById("msgList");
   box.innerHTML="";
   snap.forEach(child=>{
     let val = child.val();
     box.innerHTML += `<div class="card">${val.text}</div>`;
   });
 });
}
loadMessages();

// Sports
function loadSports(){
 let box = document.getElementById("sportsList");
 db.ref("sports/"+reg).once("value").then(snap=>{
   box.innerHTML="";
   snap.forEach(child=>{
     let val = child.val();
     box.innerHTML += `<div class="card">${val.activity}</div>`;
   });
 });
}

function logout(){
 localStorage.removeItem("student");
 window.location="index.html";
}

// Default section
openSection("profile");

</script>

</body>
</html>
