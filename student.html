<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Portal</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>

body{
font-family:Arial;
background:#f2f2f2;
margin:0;
}

/* BOX */
.box{
background:white;
max-width:400px;
margin:30px auto;
padding:20px;
border-radius:10px;
box-shadow:0 0 5px gray;
}

/* DASHBOARD */
#dash{
display:none;
padding:20px;
}

/* MENU */
.menu{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:10px;
}

.menu button{
padding:12px;
background:#1e3799;
color:white;
border:none;
border-radius:5px;
cursor:pointer;
}

input,button{
width:100%;
padding:10px;
margin:5px 0;
}

h3{text-align:center;}

</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="box">

<h3>Student Login</h3>

<input id="reg" placeholder="Registration Number">
<input id="pass" type="password" placeholder="Password">

<button onclick="login()">Login</button>
<button onclick="register()">Register</button>

<p id="msg"></p>

</div>


<!-- PROFILE -->
<div id="profile" class="box" style="display:none">

<h3>Complete Profile</h3>

<input id="name" placeholder="Full Name">
<input id="course" placeholder="Course">
<input id="level" placeholder="Level">
<input id="semester" placeholder="Semester">

<button onclick="saveProfile()">Save Profile</button>

<p id="pmsg"></p>

</div>


<!-- DASHBOARD -->
<div id="dash">

<h3 style="text-align:center">Student Dashboard</h3>

<div class="menu">

<button onclick="alert('Modules - Coming Soon')">Modules</button>

<button onclick="alert('Assignments - Coming Soon')">Assignments</button>

<button onclick="alert('Results - Coming Soon')">Results</button>

<button onclick="alert('Fees - Coming Soon')">Fees</button>

<button onclick="alert('Counselling - Coming Soon')">Counselling</button>

<button onclick="alert('Transfer - Coming Soon')">Transfer</button>

<button onclick="logout()">Logout</button>

</div>

</div>


<script>

//////////////////////////////////////////////////
// FIREBASE CONFIG (YAKO HALISI)
//////////////////////////////////////////////////

const firebaseConfig = {
  apiKey: "AIzaSyAcL_PjNww-ea6d33irNgWbn1EsBq4acTA",
  authDomain: "collegeportal-app.firebaseapp.com",
  databaseURL: "https://collegeportal-app-default-rtdb.firebaseio.com",
  projectId: "collegeportal-app",
  storageBucket: "collegeportal-app.firebasestorage.app",
  messagingSenderId: "266762331631",
  appId: "1:266762331631:web:66ddfbde53d33086ac421a"
};

// Initialize
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();


//////////////////////////////////////////////////
// REGISTER
//////////////////////////////////////////////////

function register(){

let r = document.getElementById("reg").value;
let p = document.getElementById("pass").value;

if(r=="" || p==""){
 alert("Fill all fields");
 return;
}

let email = r+"@student.com";

auth.createUserWithEmailAndPassword(email,p)
.then(()=>{

document.getElementById("msg").innerText="Registered Successfully ✅";

})
.catch(e=>alert(e.message));

}


//////////////////////////////////////////////////
// LOGIN
//////////////////////////////////////////////////

function login(){

let r = document.getElementById("reg").value;
let p = document.getElementById("pass").value;

let email = r+"@student.com";

auth.signInWithEmailAndPassword(email,p)
.then(()=>{

localStorage.setItem("reg",r);

checkProfile();

})
.catch(()=>alert("Wrong Login ❌"));

}


//////////////////////////////////////////////////
// CHECK PROFILE
//////////////////////////////////////////////////

function checkProfile(){

let r = localStorage.getItem("reg");

db.ref("students/"+r).once("value")
.then(snap=>{

if(snap.exists()){

document.getElementById("login").style.display="none";
document.getElementById("profile").style.display="none";
document.getElementById("dash").style.display="block";

}else{

document.getElementById("login").style.display="none";
document.getElementById("profile").style.display="block";

}

});

}


//////////////////////////////////////////////////
// SAVE PROFILE
//////////////////////////////////////////////////

function saveProfile(){

let r = localStorage.getItem("reg");

let data = {

 name:document.getElementById("name").value,
 course:document.getElementById("course").value,
 level:document.getElementById("level").value,
 semester:document.getElementById("semester").value

};

if(data.name=="" || data.course=="" || data.level=="" || data.semester==""){
 alert("Fill all fields");
 return;
}

db.ref("students/"+r).set(data)
.then(()=>{

document.getElementById("pmsg").innerText="Profile Saved ✅";

document.getElementById("profile").style.display="none";
document.getElementById("dash").style.display="block";

});

}


//////////////////////////////////////////////////
// LOGOUT
//////////////////////////////////////////////////

function logout(){

auth.signOut();

localStorage.clear();

location.reload();

}

</script>

</body>
</html>
