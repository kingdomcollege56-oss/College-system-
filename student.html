<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Portal</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>

body{
font-family:Arial;
background:#f2f2f2;
margin:0;
}

.box{
background:white;
max-width:400px;
margin:20px auto;
padding:20px;
border-radius:10px;
box-shadow:0 0 5px gray;
}

input,button,select,textarea{
width:100%;
padding:10px;
margin:5px 0;
}

button{
background:#1e3799;
color:white;
border:none;
border-radius:5px;
cursor:pointer;
}

.menu{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
}

.section{
display:none;
padding:15px;
}

h3{text-align:center;}

</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="box">

<h3>Student Login</h3>

<input id="reg" placeholder="Registration Number">
<input id="pass" type="password" placeholder="Password">

<button onclick="login()">Login</button>
<button onclick="register()">Register</button>

<p id="msg"></p>

</div>


<!-- PROFILE -->
<div id="profile" class="box" style="display:none">

<h3>Complete Profile</h3>

<input id="name" placeholder="Full Name">
<input id="course" placeholder="Course">
<input id="level" placeholder="Level">
<input id="semester" placeholder="Semester">

<button onclick="saveProfile()">Save Profile</button>

</div>


<!-- DASHBOARD -->
<div id="dash" style="display:none">

<h3 style="text-align:center">Dashboard</h3>

<div class="menu">

<button onclick="openSec('modules')">Modules</button>
<button onclick="openSec('assign')">Assignments</button>
<button onclick="openSec('results')">Results</button>
<button onclick="openSec('fees')">Fees</button>
<button onclick="openSec('counsel')">Counselling</button>
<button onclick="openSec('transfer')">Transfer</button>
<button onclick="logout()">Logout</button>

</div>

</div>


<!-- MODULES -->
<div id="modules" class="section box">

<h3>Register Modules</h3>

<input id="mod" placeholder="Module Name">

<button onclick="addModule()">Add</button>

<div id="modList"></div>

</div>


<!-- ASSIGNMENT -->
<div id="assign" class="section box">

<h3>Submit Assignment</h3>

<input id="asMod" placeholder="Module">
<input type="file" id="asFile">

<button onclick="sendAssign()">Submit</button>

</div>


<!-- RESULTS -->
<div id="results" class="section box">

<h3>Results</h3>

<div id="resList"></div>

</div>


<!-- FEES -->
<div id="fees" class="section box">

<h3>Fees</h3>

<p id="feeInfo"></p>

</div>


<!-- COUNSELLING -->
<div id="counsel" class="section box">

<h3>Anonymous Message</h3>

<textarea id="cmsg" placeholder="Type message"></textarea>

<button onclick="sendMsg()">Send</button>

</div>


<!-- TRANSFER -->
<div id="transfer" class="section box">

<h3>Transfer Request</h3>

<textarea id="treq" placeholder="Reason"></textarea>

<button onclick="sendTransfer()">Submit</button>

</div>


<script>

////////////////////////////////////////////////
// FIREBASE CONFIG
////////////////////////////////////////////////

const firebaseConfig = {
  apiKey: "AIzaSyAcL_PjNww-ea6d33irNgWbn1EsBq4acTA",
  authDomain: "collegeportal-app.firebaseapp.com",
  databaseURL: "https://collegeportal-app-default-rtdb.firebaseio.com",
  projectId: "collegeportal-app",
  storageBucket: "collegeportal-app.firebasestorage.app",
  messagingSenderId: "266762331631",
  appId: "1:266762331631:web:66ddfbde53d33086ac421a"
};

firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const store=firebase.storage();


////////////////////////////////////////////////
// REGISTER
////////////////////////////////////////////////

function register(){

let r=reg.value;
let p=pass.value;

if(!r||!p)return alert("Fill all");

auth.createUserWithEmailAndPassword(r+"@s.com",p)
.then(()=>msg.innerText="Registered ✅");

}


////////////////////////////////////////////////
// LOGIN
////////////////////////////////////////////////

function login(){

let r=reg.value;
let p=pass.value;

auth.signInWithEmailAndPassword(r+"@s.com",p)
.then(()=>{

localStorage.reg=r;
checkProfile();

});

}


////////////////////////////////////////////////
// CHECK PROFILE
////////////////////////////////////////////////

function checkProfile(){

let r=localStorage.reg;

db.ref("students/"+r).once("value").then(s=>{

login.style.display="none";

if(s.exists()){
dash.style.display="block";
loadAll();
}else{
profile.style.display="block";
}

});

}


////////////////////////////////////////////////
// SAVE PROFILE
////////////////////////////////////////////////

function saveProfile(){

let r=localStorage.reg;

let d={
name:name.value,
course:course.value,
level:level.value,
semester:semester.value
};

if(!d.name||!d.course||!d.level||!d.semester)
return alert("Fill all");

db.ref("students/"+r).set(d).then(()=>{

profile.style.display="none";
dash.style.display="block";

});

}


////////////////////////////////////////////////
// MENU
////////////////////////////////////////////////

function openSec(id){

document.querySelectorAll(".section")
.forEach(s=>s.style.display="none");

document.getElementById(id).style.display="block";

}


////////////////////////////////////////////////
// MODULES
////////////////////////////////////////////////

function addModule(){

let r=localStorage.reg;
let m=mod.value;

if(!m)return;

db.ref("modules/"+r+"/"+m).set(true);

loadModules();

mod.value="";

}

function loadModules(){

let r=localStorage.reg;

db.ref("modules/"+r).on("value",s=>{

modList.innerHTML="";

s.forEach(c=>{
modList.innerHTML+="<p>"+c.key+"</p>";
});

});

}


////////////////////////////////////////////////
// ASSIGNMENT
////////////////////////////////////////////////

function sendAssign(){

let r=localStorage.reg;
let m=asMod.value;
let f=asFile.files[0];

if(!m||!f)return alert("Fill all");

let ref=store.ref("assign/"+r+"/"+f.name);

ref.put(f).then(()=>{

ref.getDownloadURL().then(u=>{

db.ref("assignments/"+r+"/"+m).push({
file:u,
time:Date.now()
});

alert("Submitted ✅");

});

});

}


////////////////////////////////////////////////
// RESULTS
////////////////////////////////////////////////

function loadResults(){

let r=localStorage.reg;

db.ref("results/"+r).on("value",s=>{

resList.innerHTML="";

s.forEach(c=>{

resList.innerHTML+="<p>"+c.key+" : "+c.val()+"</p>";

});

});

}


////////////////////////////////////////////////
// FEES
////////////////////////////////////////////////

function loadFees(){

let r=localStorage.reg;

db.ref("fees/"+r).on("value",s=>{

if(s.exists()){

let d=s.val();

feeInfo.innerText=
"Paid: "+d.paid+" | Balance: "+d.balance;

}else{

feeInfo.innerText="No data";

}

});

}


////////////////////////////////////////////////
// COUNSELLING
////////////////////////////////////////////////

function sendMsg(){

let m=cmsg.value;

if(!m)return;

db.ref("counsel").push({
msg:m,
time:Date.now()
});

cmsg.value="";
alert("Sent ✅");

}


////////////////////////////////////////////////
// TRANSFER
////////////////////////////////////////////////

function sendTransfer(){

let r=localStorage.reg;
let t=treq.value;

if(!t)return;

db.ref("transfer/"+r).set({
msg:t,
status:"Pending"
});

alert("Sent ✅");

}


////////////////////////////////////////////////
// LOAD ALL
////////////////////////////////////////////////

function loadAll(){

loadModules();
loadResults();
loadFees();

}


////////////////////////////////////////////////
// LOGOUT
////////////////////////////////////////////////

function logout(){

auth.signOut();
localStorage.clear();
location.reload();

}


</script>

</body>
</html>
