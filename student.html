<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Dashboard - Kingdom College</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  margin:0;
  font-family:Arial;
  background:#e8f1fb;
}
header{
  background:#0a3d62;
  color:white;
  padding:20px;
  text-align:center;
}
.container{
  display:flex;
  min-height:calc(100vh - 120px);
}
.sidebar{
  width:220px;
  background:#1e3799;
  color:white;
  display:flex;
  flex-direction:column;
  padding-top:20px;
}
.sidebar button{
  background:none;
  border:none;
  color:white;
  padding:12px 20px;
  text-align:left;
  font-weight:bold;
  cursor:pointer;
  font-size:15px;
}
.sidebar button:hover{
  background:#4a69bd;
}
.main{
  flex:1;
  padding:20px;
}
section{
  display:none;
  padding:15px;
  background:white;
  border-radius:8px;
  box-shadow:0 0 5px #ccc;
  margin-bottom:20px;
}
section.active{
  display:block;
}
input,textarea,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:5px;
  border:1px solid #ccc;
}
button.action{
  padding:12px;
  background:#1e3799;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
}
button.action:hover{
  background:#4a69bd;
}
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
}
.gallery img{
  width:100%;
  height:100px;
  object-fit:cover;
  border-radius:5px;
}
footer{
  background:#0a3d62;
  color:white;
  text-align:center;
  padding:15px;
}
</style>
</head>
<body>

<header>
<h1>Kingdom College of Health & Allied Sciences</h1>
<p>Welcome Student Dashboard</p>
</header>

<div class="container">
  <div class="sidebar">
    <button onclick="showSection('dashboard')">ğŸ  Dashboard</button>
    <button onclick="showSection('profile')">ğŸ‘¤ Profile</button>
    <button onclick="showSection('courses')">ğŸ“š Courses</button>
    <button onclick="showSection('results')">ğŸ“ Results</button>
    <button onclick="showSection('fees')">ğŸ’° Fees</button>
    <button onclick="showSection('timetable')">ğŸ“… Timetable</button>
    <button onclick="showSection('notices')">ğŸ“¢ Notices</button>
    <button onclick="showSection('downloads')">ğŸ“‚ Downloads</button>
    <button onclick="showSection('assignments')">ğŸ“¤ Assignments</button>
    <button onclick="showSection('transfer')">ğŸ” Transfer Form</button>
    <button onclick="showSection('secret')">ğŸ”’ Secret SMS</button>
    <button onclick="showSection('sports')">ğŸ† Sports & Games</button>
    <button onclick="showSection('settings')">âš™ï¸ Settings</button>
    <button onclick="logout()">ğŸšª Logout</button>
  </div>
  
  <div class="main">
    <!-- Dashboard -->
    <section id="dashboard" class="active">
      <h2>Welcome Student</h2>
      <p id="studentName">Loading...</p>
      <p id="regNo"></p>
      <p id="courseLevel"></p>
      <p id="status"></p>
      <p id="gpa"></p>
    </section>

    <!-- Profile -->
    <section id="profile">
      <h2>Profile</h2>
      <p id="profileInfo">Loading...</p>
    </section>

    <!-- Courses -->
    <section id="courses">
      <h2>Courses</h2>
      <ul id="courseList"></ul>
    </section>

    <!-- Results -->
    <section id="results">
      <h2>Results / Transcript</h2>
      <table border="1" width="100%" id="resultsTable">
        <tr><th>Subject</th><th>Test</th><th>Mid</th><th>Final</th><th>GPA</th></tr>
      </table>
    </section>

    <!-- Fees -->
    <section id="fees">
      <h2>Fees & Payments</h2>
      <p id="feesInfo">Loading...</p>
    </section>

    <!-- Timetable -->
    <section id="timetable">
      <h2>Timetable</h2>
      <p id="timetableInfo">Loading...</p>
    </section>

    <!-- Notices -->
    <section id="notices">
      <h2>Notices & Announcements</h2>
      <div id="noticesBox">Loading...</div>
    </section>

    <!-- Downloads -->
    <section id="downloads">
      <h2>Downloads</h2>
      <div id="downloadsBox">Loading...</div>
    </section>

    <!-- Assignments -->
    <section id="assignments">
      <h2>Submit Assignment</h2>
      <input id="assignTitle" placeholder="Assignment Title">
      <select id="assignSubject"></select>
      <input type="file" id="assignFile">
      <button class="action" onclick="submitAssignment()">Upload Assignment</button>
      <p id="assignMsg"></p>
    </section>

    <!-- Transfer Form -->
    <section id="transfer">
      <h2>Transfer Form</h2>
      <input id="transferReason" placeholder="Reason for Transfer">
      <input id="transferDest" placeholder="Destination College">
      <button class="action" onclick="submitTransfer()">Submit Transfer Request</button>
      <p id="transferMsg"></p>
    </section>

    <!-- Secret SMS -->
    <section id="secret">
      <h2>Secret SMS</h2>
      <textarea id="secretMsg" placeholder="Write your message"></textarea>
      <button class="action" onclick="sendSecret()">Send Secret Message</button>
      <p id="secretInfo"></p>
    </section>

    <!-- Sports & Games -->
    <section id="sports">
      <h2>Sports & Games</h2>

      <h3>Available Teams</h3>
      <ul id="teamList"></ul>

      <h3>Fixtures</h3>
      <ul id="fixturesList"></ul>

      <h3>Results</h3>
      <ul id="resultsSportsList"></ul>

      <h3>Register for Sport</h3>
      <select id="sportSelect"></select>
      <button class="action" onclick="registerSport()">Register</button>
      <p id="sportMsg"></p>
    </section>

    <!-- Settings -->
    <section id="settings">
      <h2>Settings</h2>
      <input type="password" id="newPass" placeholder="New Password">
      <button class="action" onclick="changePassword()">Change Password</button>
    </section>

  </div>
</div>

<footer>
<p>Â© 2026 Kingdom College</p>
<p>Developed by Irene ğŸ’™</p>
</footer>

<script>
// Firebase config
const firebaseConfig = {
apiKey: "AIzaSyAcL_PjNww-ea6d33irNgWbn1EsBq4acTA",
authDomain: "collegeportal-app.firebaseapp.com",
databaseURL: "https://collegeportal-app-default-rtdb.firebaseio.com",
projectId: "collegeportal-app",
storageBucket: "collegeportal-app.appspot.com",
messagingSenderId: "266762331631",
appId: "1:266762331631:web:66ddfbde53d33086ac421a"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

// Sidebar switching
function showSection(id){
  document.querySelectorAll('section').forEach(sec=>{
    sec.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

// Logout
function logout(){
  auth.signOut().then(()=>{window.location="index.html";});
}

// Load student info
auth.onAuthStateChanged(user=>{
  if(!user) window.location="index.html";
  const uid=user.uid;
  db.ref("students/"+uid+"/profile").once("value").then(s=>{
    const data=s.val();
    if(data){
      studentName.innerText="Name: "+data.name;
      regNo.innerText="Reg#: "+data.regNo;
      courseLevel.innerText="Course: "+data.course+" | Level "+data.level;
      status.innerText="Status: "+data.status;
    }
  });
  db.ref("students/"+uid+"/results").once("value").then(s=>{
    resultsTable.innerHTML='<tr><th>Subject</th><th>Test</th><th>Mid</th><th>Final</th><th>GPA</th></tr>';
    s.forEach(sub=>{
      const d=sub.val();
      const row=document.createElement('tr');
      row.innerHTML=`<td>${d.subject}</td><td>${d.test}</td><td>${d.mid}</td><td>${d.final}</td><td>${d.gpa}</td>`;
      resultsTable.appendChild(row);
    });
  });
  db.ref("students/"+uid+"/fees").once("value").then(s=>{
    feesInfo.innerText="Total Fee: "+s.val().total+" | Paid: "+s.val().paid+" | Balance: "+s.val().balance;
  });
  db.ref("students/"+uid+"/courses").once("value").then(s=>{
    courseList.innerHTML="";
    assignSubject.innerHTML="";
    s.forEach(c=>{
      courseList.innerHTML+='<li>'+c.val()+'</li>';
      assignSubject.innerHTML+='<option value="'+c.val()+'">'+c.val()+'</option>';
    });
  });
});

// Notices
db.ref("announcements").on("value",s=>{
  noticesBox.innerHTML="";
  s.forEach(n=>{
    noticesBox.innerHTML+='<div>'+n.val()+'</div>';
  });
});

// Downloads
db.ref("downloads").on("value",s=>{
  downloadsBox.innerHTML="";
  s.forEach(f=>{
    downloadsBox.innerHTML+='<div><a href="'+f.val()+'" target="_blank">'+f.key+'</a></div>';
  });
});

// Assignment submission
function submitAssignment(){
  const uid=auth.currentUser.uid;
  const file=assignFile.files[0];
  const subject=assignSubject.value;
  const title=assignTitle.value;
  if(!file||!subject||!title){assignMsg.innerText="Fill all fields";return;}
  const ref=storage.ref("assignments/"+uid+"/"+file.name);
  ref.put(file).then(()=>{
    ref.getDownloadURL().then(url=>{
      db.ref("assignments/"+subject+"/"+uid).push({title:url,uploadedAt:Date.now()});
      assignMsg.innerText="Assignment Uploaded âœ”";
    });
  });
}

// Transfer form
function submitTransfer(){
  const uid=auth.currentUser.uid;
  const reason=transferReason.value;
  const dest=transferDest.value;
  if(!reason||!dest){transferMsg.innerText="Fill all fields";return;}
  db.ref("transferRequests/"+uid).push({reason:reason,destination:dest,date:Date.now(),status:"Pending"});
  transferMsg.innerText="Transfer Request Sent âœ”";
}

// Secret SMS
function sendSecret(){
  const uid=auth.currentUser.uid;
  const msg=secretMsg.value;
  if(!msg){secretInfo.innerText="Message empty";return;}
  db.ref("secretMessages").push({message:msg,from:uid,date:Date.now()});
  secretInfo.innerText="Secret Message Sent âœ”";
  secretMsg.value="";
}

// Sports & Games
db.ref("sports/teams").on("value",snap=>{
  teamList.innerHTML="";
  sportSelect.innerHTML="";
  snap.forEach(team=>{
    const t=team.val();
    teamList.innerHTML+='<li>'+t.name+' ('+t.category+')</li>';
    sportSelect.innerHTML+='<option value="'+t.name+'">'+t.name+'</option>';
  });
});
db.ref("sports/fixtures").on("value",snap=>{
  fixturesList.innerHTML="";
  snap.forEach(f=>{
    const d=f.val();
    fixturesList.innerHTML+='<li>'+d.teamA+' vs '+d.teamB+' | '+d.date+'</li>';
  });
});
db.ref("sports/results").on("value",snap=>{
  resultsSportsList.innerHTML="";
  snap.forEach(r=>{
    const d=r.val();
    resultsSportsList.innerHTML+='<li>'+d.teamA+' '+d.scoreA+' - '+d.scoreB+' '+d.teamB+'</li>';
  });
});
function registerSport(){
  const uid=auth.currentUser.uid;
  const sport=sportSelect.value;
  if(!sport){sportMsg.innerText="Select a sport"; return;}
  db.ref("sports/registrations/"+sport+"/"+uid).set({registeredAt:Date.now()});
  sportMsg.innerText="Registered for "+sport+" âœ”";
}

// Change password
function changePassword(){
  const user=auth.currentUser;
  const pass=newPass.value;
  if(pass.length<6){alert("Password must be at least 6 chars");return;}
  user.updatePassword(pass).then(()=>{alert("Password Changed âœ”");newPass.value="";});
}
</script>

</body>
</html>
